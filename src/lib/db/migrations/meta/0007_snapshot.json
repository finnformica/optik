{
  "id": "d915196b-3127-4726-b3e9-c55ff943b97c",
  "prevId": "849b6712-57e3-4cf6-bdc6-0a9603682c3c",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.activity_logs": {
      "name": "activity_logs",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "team_id": {
          "name": "team_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "action": {
          "name": "action",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "timestamp": {
          "name": "timestamp",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "ip_address": {
          "name": "ip_address",
          "type": "varchar(45)",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "activity_logs_team_id_teams_id_fk": {
          "name": "activity_logs_team_id_teams_id_fk",
          "tableFrom": "activity_logs",
          "tableTo": "teams",
          "columnsFrom": [
            "team_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "no action",
          "onUpdate": "no action"
        },
        "activity_logs_user_id_users_id_fk": {
          "name": "activity_logs_user_id_users_id_fk",
          "tableFrom": "activity_logs",
          "tableTo": "users",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "no action",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitations": {
      "name": "invitations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "team_id": {
          "name": "team_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "varchar(50)",
          "primaryKey": false,
          "notNull": true
        },
        "invited_by": {
          "name": "invited_by",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "invited_at": {
          "name": "invited_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "status": {
          "name": "status",
          "type": "varchar(20)",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitations_team_id_teams_id_fk": {
          "name": "invitations_team_id_teams_id_fk",
          "tableFrom": "invitations",
          "tableTo": "teams",
          "columnsFrom": [
            "team_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "no action",
          "onUpdate": "no action"
        },
        "invitations_invited_by_users_id_fk": {
          "name": "invitations_invited_by_users_id_fk",
          "tableFrom": "invitations",
          "tableTo": "users",
          "columnsFrom": [
            "invited_by"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "no action",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.team_members": {
      "name": "team_members",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "team_id": {
          "name": "team_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "varchar(50)",
          "primaryKey": false,
          "notNull": true
        },
        "joined_at": {
          "name": "joined_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "team_members_user_id_users_id_fk": {
          "name": "team_members_user_id_users_id_fk",
          "tableFrom": "team_members",
          "tableTo": "users",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "no action",
          "onUpdate": "no action"
        },
        "team_members_team_id_teams_id_fk": {
          "name": "team_members_team_id_teams_id_fk",
          "tableFrom": "team_members",
          "tableTo": "teams",
          "columnsFrom": [
            "team_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "no action",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.teams": {
      "name": "teams",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "varchar(100)",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "stripe_customer_id": {
          "name": "stripe_customer_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "stripe_subscription_id": {
          "name": "stripe_subscription_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "stripe_product_id": {
          "name": "stripe_product_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "plan_name": {
          "name": "plan_name",
          "type": "varchar(50)",
          "primaryKey": false,
          "notNull": false
        },
        "subscription_status": {
          "name": "subscription_status",
          "type": "varchar(20)",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "teams_stripe_customer_id_unique": {
          "name": "teams_stripe_customer_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "stripe_customer_id"
          ]
        },
        "teams_stripe_subscription_id_unique": {
          "name": "teams_stripe_subscription_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "stripe_subscription_id"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.transactions": {
      "name": "transactions",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "transaction_id": {
          "name": "transaction_id",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        },
        "broker": {
          "name": "broker",
          "type": "broker",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "date": {
          "name": "date",
          "type": "date",
          "primaryKey": false,
          "notNull": true
        },
        "action": {
          "name": "action",
          "type": "transaction_action",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "ticker": {
          "name": "ticker",
          "type": "varchar(50)",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "quantity": {
          "name": "quantity",
          "type": "numeric(18, 8)",
          "primaryKey": false,
          "notNull": true
        },
        "fees": {
          "name": "fees",
          "type": "numeric(18, 8)",
          "primaryKey": false,
          "notNull": true,
          "default": "'0'"
        },
        "amount": {
          "name": "amount",
          "type": "numeric(18, 8)",
          "primaryKey": false,
          "notNull": true
        },
        "strike_price": {
          "name": "strike_price",
          "type": "numeric(18, 8)",
          "primaryKey": false,
          "notNull": false
        },
        "expiry_date": {
          "name": "expiry_date",
          "type": "date",
          "primaryKey": false,
          "notNull": false
        },
        "option_type": {
          "name": "option_type",
          "type": "varchar(50)",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "transactions_user_id_users_id_fk": {
          "name": "transactions_user_id_users_id_fk",
          "tableFrom": "transactions",
          "tableTo": "users",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "no action",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "transactions_transaction_id_unique": {
          "name": "transactions_transaction_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "transaction_id"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_access_tokens": {
      "name": "user_access_tokens",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "encrypted_tokens": {
          "name": "encrypted_tokens",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token_type": {
          "name": "token_type",
          "type": "varchar(50)",
          "primaryKey": false,
          "notNull": true
        },
        "scope": {
          "name": "scope",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "broker": {
          "name": "broker",
          "type": "broker",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "user_access_tokens_user_id_users_id_fk": {
          "name": "user_access_tokens_user_id_users_id_fk",
          "tableFrom": "user_access_tokens",
          "tableTo": "users",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "no action",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.users": {
      "name": "users",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "varchar(100)",
          "primaryKey": false,
          "notNull": false
        },
        "email": {
          "name": "email",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "password_hash": {
          "name": "password_hash",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "varchar(20)",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "deleted_at": {
          "name": "deleted_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "users_email_unique": {
          "name": "users_email_unique",
          "nullsNotDistinct": false,
          "columns": [
            "email"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.broker": {
      "name": "broker",
      "schema": "public",
      "values": [
        "schwab",
        "robinhood",
        "etrade",
        "fidelity",
        "tda",
        "vanguard"
      ]
    },
    "public.transaction_action": {
      "name": "transaction_action",
      "schema": "public",
      "values": [
        "buy",
        "sell",
        "buy_to_open",
        "sell_to_close",
        "sell_to_open",
        "buy_to_close",
        "expire",
        "assign",
        "dividend",
        "interest",
        "transfer",
        "other"
      ]
    }
  },
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {
    "public.account_value_over_time": {
      "columns": {
        "user_id": {
          "name": "user_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "week_start": {
          "name": "week_start",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "cumulative_transfers": {
          "name": "cumulative_transfers",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "cumulative_portfolio_value": {
          "name": "cumulative_portfolio_value",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "definition": "\n  WITH weekly_data AS (\n    SELECT \n      user_id,\n      DATE_TRUNC('week', date)::date as week_start,\n      -- Weekly transfers (money wire in/out)\n      SUM(CASE WHEN action = 'transfer' THEN amount::numeric ELSE 0 END) as weekly_transfers,\n      -- Weekly gains/losses from trading, dividends, and interest (NOT including transfers)\n      SUM(CASE \n        WHEN action != 'transfer' THEN amount::numeric - fees::numeric\n        ELSE 0\n      END) as weekly_gains\n    FROM transactions\n    WHERE action != 'other'\n    GROUP BY user_id, DATE_TRUNC('week', date)\n  )\n  SELECT \n    user_id,\n    week_start,\n    SUM(weekly_transfers) OVER (PARTITION BY user_id ORDER BY week_start) as cumulative_transfers,\n    SUM(weekly_transfers) OVER (PARTITION BY user_id ORDER BY week_start) + \n    SUM(weekly_gains) OVER (PARTITION BY user_id ORDER BY week_start) as cumulative_portfolio_value\n  FROM weekly_data\n  ORDER BY user_id, week_start\n",
      "name": "account_value_over_time",
      "schema": "public",
      "isExisting": false,
      "materialized": false
    },
    "public.current_positions": {
      "columns": {
        "user_id": {
          "name": "user_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "ticker": {
          "name": "ticker",
          "type": "varchar(50)",
          "primaryKey": false,
          "notNull": false
        },
        "option_type": {
          "name": "option_type",
          "type": "varchar(50)",
          "primaryKey": false,
          "notNull": false
        },
        "strike_price": {
          "name": "strike_price",
          "type": "numeric(18, 8)",
          "primaryKey": false,
          "notNull": false
        },
        "expiry_date": {
          "name": "expiry_date",
          "type": "date",
          "primaryKey": false,
          "notNull": false
        }
      },
      "definition": "select \"user_id\", \"ticker\", \"option_type\", \"strike_price\", \"expiry_date\", SUM(\"quantity\"::numeric) as \"net_quantity\", SUM(CASE \n        WHEN \"option_type\" IS NOT NULL THEN \"strike_price\"::numeric * 100 * \"quantity\"::numeric\n        ELSE \"amount\"::numeric\n      END) as \"cost_basis\", MAX(\"date\") as \"last_transaction_date\", CASE \n        WHEN \"option_type\" IS NOT NULL THEN 'OPTION'\n        ELSE 'EQUITY'\n      END as \"position_type\", CASE \n        WHEN \"expiry_date\" IS NULL THEN NULL\n        WHEN \"expiry_date\" < CURRENT_DATE THEN \"expiry_date\"::text || ' (EXPIRED)'\n        ELSE \"expiry_date\"::text || ' (' || (\"expiry_date\" - CURRENT_DATE) || 'd)'\n      END as \"expiry_display\" from \"transactions\" where \"transactions\".\"action\" NOT IN ('dividend', 'interest', 'transfer', 'other') group by \"transactions\".\"user_id\", \"transactions\".\"ticker\", \"transactions\".\"option_type\", \"transactions\".\"strike_price\", \"transactions\".\"expiry_date\" having SUM(\"transactions\".\"quantity\"::numeric) != 0",
      "name": "current_positions",
      "schema": "public",
      "isExisting": false,
      "materialized": false
    },
    "public.portfolio_distribution": {
      "columns": {
        "user_id": {
          "name": "user_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "ticker": {
          "name": "ticker",
          "type": "varchar(50)",
          "primaryKey": false,
          "notNull": false
        }
      },
      "definition": "select \"user_id\", \"ticker\", \"position_type\", CASE \n        WHEN \"position_type\" = 'OPTION' AND \"strike_price\" IS NOT NULL \n        THEN ABS(\"net_quantity\"::numeric * 100 * \"strike_price\"::numeric)\n        ELSE ABS(\"cost_basis\")\n      END as \"position_value\", \"net_quantity\", (CURRENT_DATE - \"last_transaction_date\") as \"days_held\" from \"current_positions\" order by CASE \n      WHEN \"position_type\" = 'OPTION' AND \"current_positions\".\"strike_price\" IS NOT NULL \n      THEN ABS(\"net_quantity\"::numeric * 100 * \"current_positions\".\"strike_price\"::numeric)\n      ELSE ABS(\"cost_basis\")\n    END DESC",
      "name": "portfolio_distribution",
      "schema": "public",
      "isExisting": false,
      "materialized": false
    },
    "public.portfolio_summary": {
      "columns": {
        "user_id": {
          "name": "user_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "portfolio_value": {
          "name": "portfolio_value",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "cash_balance": {
          "name": "cash_balance",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "monthly_pnl": {
          "name": "monthly_pnl",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "yearly_pnl": {
          "name": "yearly_pnl",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "weekly_pnl_amount": {
          "name": "weekly_pnl_amount",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "monthly_pnl_percent": {
          "name": "monthly_pnl_percent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "yearly_pnl_percent": {
          "name": "yearly_pnl_percent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "total_income": {
          "name": "total_income",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "total_fees": {
          "name": "total_fees",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "unique_tickers": {
          "name": "unique_tickers",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "total_transactions": {
          "name": "total_transactions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "first_transaction_date": {
          "name": "first_transaction_date",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "last_transaction_date": {
          "name": "last_transaction_date",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "definition": "\n  WITH portfolio_totals AS (\n    SELECT \n      user_id,\n      -- Portfolio Value = Sum of all normalized amounts minus fees\n      SUM(amount::numeric) - SUM(fees::numeric) as portfolio_value,\n      -- Total transfers (money deposited/withdrawn)\n      SUM(CASE WHEN action = 'transfer' THEN amount::numeric ELSE 0 END) as total_transfers,\n      SUM(CASE WHEN action IN ('dividend', 'interest') THEN amount::numeric ELSE 0 END) as total_income,\n      SUM(fees::numeric) as total_fees,\n      COUNT(DISTINCT ticker) as unique_tickers,\n      COUNT(*) as total_transactions,\n      MIN(date) as first_transaction_date,\n      MAX(date) as last_transaction_date\n    FROM transactions\n    WHERE action != 'other'\n    GROUP BY user_id\n  ),\n  monthly_pnl AS (\n    SELECT \n      user_id,\n      SUM(amount::numeric) - SUM(fees::numeric) as monthly_pnl\n    FROM transactions\n    WHERE action NOT IN ('transfer', 'other') \n      AND date >= DATE_TRUNC('month', CURRENT_DATE)\n    GROUP BY user_id\n  ),\n  yearly_pnl AS (\n    SELECT \n      user_id,\n      SUM(amount::numeric) - SUM(fees::numeric) as yearly_pnl\n    FROM transactions\n    WHERE action NOT IN ('transfer', 'other')\n      AND date >= DATE_TRUNC('year', CURRENT_DATE)\n    GROUP BY user_id\n  ),\n  position_values AS (\n    SELECT \n      user_id,\n      -- Sum of cost basis for all current open positions (actual money tied up in positions)\n      COALESCE(SUM(cost_basis::numeric), 0) as total_position_cost\n    FROM current_positions\n    GROUP BY user_id\n  ),\n  weekly_pnl AS (\n    SELECT \n      user_id,\n      SUM(amount::numeric) - SUM(fees::numeric) as weekly_pnl\n    FROM transactions\n    WHERE action NOT IN ('transfer', 'other') \n      AND date >= DATE_TRUNC('week', CURRENT_DATE)\n    GROUP BY user_id\n  )\n  SELECT \n    pt.user_id,\n    pt.portfolio_value::text,\n    -- Cash Balance = Portfolio Value - Position Cost Basis (available cash)\n    (pt.portfolio_value - COALESCE(pv.total_position_cost, 0))::text as cash_balance,\n    COALESCE(mp.monthly_pnl, 0)::text as monthly_pnl,\n    COALESCE(yp.yearly_pnl, 0)::text as yearly_pnl,\n    -- Weekly P&L amount (absolute dollar change this week)\n    COALESCE(wp.weekly_pnl, 0)::text as weekly_pnl_amount,\n    -- Monthly P&L as percentage of portfolio\n    CASE \n      WHEN pt.portfolio_value > 0 AND mp.monthly_pnl IS NOT NULL\n      THEN ((mp.monthly_pnl / pt.portfolio_value) * 100)::text\n      ELSE '0'\n    END as monthly_pnl_percent,\n    -- Yearly P&L as percentage of portfolio\n    CASE \n      WHEN pt.portfolio_value > 0 AND yp.yearly_pnl IS NOT NULL\n      THEN ((yp.yearly_pnl / pt.portfolio_value) * 100)::text\n      ELSE '0'\n    END as yearly_pnl_percent,\n    pt.total_income::text,\n    pt.total_fees::text,\n    pt.unique_tickers::text,\n    pt.total_transactions::text,\n    pt.first_transaction_date::text,\n    pt.last_transaction_date::text\n  FROM portfolio_totals pt\n  LEFT JOIN monthly_pnl mp ON pt.user_id = mp.user_id\n  LEFT JOIN yearly_pnl yp ON pt.user_id = yp.user_id\n  LEFT JOIN position_values pv ON pt.user_id = pv.user_id\n  LEFT JOIN weekly_pnl wp ON pt.user_id = wp.user_id\n",
      "name": "portfolio_summary",
      "schema": "public",
      "isExisting": false,
      "materialized": false
    },
    "public.weekly_performance": {
      "columns": {
        "user_id": {
          "name": "user_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        }
      },
      "definition": "select \"user_id\", DATE_TRUNC('week', \"date\")::date as \"week_start\", SUM(\"amount\"::numeric) - SUM(\"fees\"::numeric) as \"weekly_pnl\", COUNT(*) as \"transaction_count\" from \"transactions\" where \"transactions\".\"action\" NOT IN ('transfer', 'other') group by \"transactions\".\"user_id\", DATE_TRUNC('week', \"transactions\".\"date\") order by \"transactions\".\"user_id\", week_start DESC",
      "name": "weekly_performance",
      "schema": "public",
      "isExisting": false,
      "materialized": false
    }
  },
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}